{% load static %}
{% load djangorave_tags %}
<!--
    User email is required by Rave, therefore user must be signed in before
    button will be displayed.
-->
<script>
    function createPaymentParams() {
        //
        // Create payment params which will be sent to Rave upon payment
        //
        {% autoescape off %}
        let pay_button_params = JSON.parse('{% if user.is_authenticated %}{% pay_button_params user_pk=user.pk plan_pk=plan.pk %}{% endif %}');
        {% endautoescape %}
        paymentParams['{{ plan.description }}'] = {
            public_key: pay_button_params.public_key,
            tx_ref: pay_button_params.tx_ref,
            amount: '{{ plan.amount }}',
            currency: '{{ plan.currency }}',
            payment_options: '{{ plan.payment_options }}',
            redirect_url: pay_button_params.redirect_url,
            payment_plan: '{{ plan.payment_plan }}',
            customer: {
                email: '{{ user.email }}',
                name: '{{ user.first_name }} {{ user.last_name }}',
            },
            customizations: {
                title: 'title here',
                description: 'desc here',
                logo: '',
            },
        }
    }
    if ('{{ user.is_authenticated }}' === 'True') {
        createPaymentParams();
    }
</script>
<script type="text/javascript" src="{% rave_inline_js %}"></script>
{% if user.is_authenticated %}
<button
    class="rave-pay-btn {% if plan.payment_plan %}rave-subscription-btn{% else %}rave-onceoff-btn{% endif %}"
    type="button"
    onClick="makePayment(paymentParams['{{ plan.description }}'])">
    {{ plan.pay_button_text }}
</button>
{% else %}
<p>User must be signed in</p>
{% endif %}